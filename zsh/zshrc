# Powerlevel10k instant prompt
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

# Z-Shell Config
HISTFILE="$HOME/.zsh_history"
HISTSIZE=99999
SAVEHIST=99999
setopt appendhistory
setopt incappendhistory

# Exports
export TERM="xterm-256color"
export LANG="en_US.UTF-8"
export LC_CTYPE="en_US.UTF-8"
export PAGER="less -R"
export SHELL="zsh"
export EDITOR="nvim"
export NIX_PATH="${NIX_PATH:+$NIX_PATH:}$HOME/.nix-defexpr/channels:/nix/var/nix/profiles/per-user/root/channels"
export GOPATH="$HOME/.go"
export EXA_COLORS="da=1;31"

# Aliases
alias dotfiles="echo 'Updating \e[4m~/.config/dotfiles\e[0m...' && cd ~/.config/dotfiles && git pull && cd"
alias reload="echo 'Reloading \e[4m~/.zshrc\e[0m...' && source ~/.zshrc"
alias vi="nvim"
alias vim="nvim"
alias vimdiff="nvim -d"
alias ls="exa --icons"
alias tree="exa --icons --tree"
alias cat="bat"
alias tmux="TERM=screen-256color-bce tmux"
alias htop="btop"
alias tf="terraform"

# Init mcfly
if [[ $(command -v mcfly) > /dev/null ]]; then
  eval "$(mcfly init zsh)"
fi

# Init pyenv
if [[ -f "${HOME}/.pyenv/bin/pyenv" ]]; then
  export PYENV_ROOT="$HOME/.pyenv"
  command -v pyenv >/dev/null || export PATH="$PYENV_ROOT/bin:$PATH"
  eval "$(pyenv init -)"
  eval "$(pyenv virtualenv-init -)" >/dev/null 2>&1
fi

# Darwin only
if [[ $(uname) == "Darwin" ]]; then
  # nix daemon
  if [ -e "/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh" ]; then
    source "/nix/var/nix/profiles/default/etc/profile.d/nix-daemon.sh"
  fi

  # nix-darwin
  alias rebuild="${HOME}/.config/dotfiles/nix/darwin-rebuild.sh"

  # iTerm2
  if [ -e "${HOME}/.iterm2_shell_integration.zsh" ]; then
    source "${HOME}/.iterm2_shell_integration.zsh"
  fi

  # tailscale
  alias tailscale="/Applications/Tailscale.app/Contents/MacOS/Tailscale"
fi

# Z-Shell Plugins
source "${HOME}/.config/dotfiles/zsh/powerlevel10k/powerlevel10k.zsh-theme"
source "${HOME}/.config/dotfiles/zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
source "${HOME}/.config/dotfiles/zsh/zsh-autosuggestions/zsh-autosuggestions.zsh"
source "${HOME}/.config/dotfiles/zsh/zsh-nix-shell/nix-shell.plugin.zsh"

# Powerlevel10k
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

